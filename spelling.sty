%%% spelling.sty
%%% Copyright 2012 Stephan Hennig
%%
%% This work may be distributed and/or modified under the conditions of
%% the LaTeX Project Public License, either version 1.3 of this license
%% or (at your option) any later version.  The latest version of this
%% license is in http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% See file README for more information.
%%
\ProvidesPackage{spelling}
  [2012/11/25 v0.1 Aid spell-checking (SH)]
\NeedsTeXFormat{LaTeX2e}[1999/12/01]
% Test for the LuaTeX engine.
\RequirePackage{ifluatex}
\ifluatex
\else
\PackageError{spelling}{LuaTeX engine required}{You could try with the
  `lualatex' command.}
\fi
\RequirePackage{luatexbase}
\directlua name {spelling}{dofile('spelling.lua')}
% Words are extracted after pages have been built.  In lack of a proper
% Lua call-back, we're hooking into shipout from the LaTeX side.
\RequirePackage{atbegshi}
\AtBeginShipout{%
  \directlua name {spelling-atbeginshipout}{cb_AtBeginShipout_pkg_spelling(\the\AtBeginShipoutBox)}%
}
% Provide command for reading-in a list of bad spellings.
\newcommand*{\spellingreadbad}[1]{%
  \directlua{
    pkg_spelling_stage[1].read_bad_strings('\luaescapestring{#1}')
  }%
}
% Try to read a list of bad spellings from file `\jobname.spb'.
\IfFileExists{\jobname.spb}{%
  \spellingreadbad{\jobname.spb}%
}{%
}

%%% spelling-doc.sty
%%% Copyright 2012 Stephan Hennig
%%
%% This work may be distributed and/or modified under the conditions of
%% the LaTeX Project Public License, either version 1.3 of this license
%% or (at your option) any later version.  The latest version of this
%% license is in http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
%% See file README for more information.
%%
\documentclass[11pt]{article}
\usepackage{fontspec}
\defaultfontfeatures{Ligatures=TeX}
\usepackage{multicol}
\usepackage{listings}
\lstset{
  basicstyle=\ttfamily,
  columns=spaceflexible,
}
% Short-cut for non-language code snippets.
\lstMakeShortInline\|
% Short-cut for LaTeX code snippets.
\lstMakeShortInline[
language={[LaTeX]TeX},
basicstyle=\ttfamily,
]°
\usepackage{xspace}
\usepackage[latin, UKenglish]{babel}
\usepackage[rgb, x11names]{xcolor}
\usepackage{hyperref}
\hypersetup{
  pdftitle={spelling},
  pdfauthor={Stephan Hennig},
  pdfkeywords={spell-checking, spelling, TeX, LuaTeX}
}
\hypersetup{
  english,% For \autoref.
  pdfstartview={XYZ null null null},% Zoom factor is determined by viewer.
  colorlinks,
  linkcolor=RoyalBlue3,
  urlcolor=Chocolate4,
  citecolor=DeepPink2
}
\usepackage{spelling}
\spellingreadbad{\jobname.bad}
\newcommand*{\pkg}{\textsf{spelling}}
\newcommand*{\acr}[1]{\mbox{\scshape#1}}
\newcommand*{\descr}[1]{〈\emph{#1}〉}
\newcommand*{\cmd}[1]{\mbox{\ttfamily\textbackslash#1}}
\newcommand*{\macro}[1]{\cmd{#1}\marginpar{\cmd{#1}}}
\newcommand*{\latinphrase}[1]{\foreignlanguage{latin}{\emph{#1}}}
\newcommand*{\lpeg}{\latinphrase{e.\,g.}\xspace}
\newcommand*{\lpie}{\latinphrase{i.\,e.}\xspace}
\begin{document}
\author{Stephan Hennig\thanks{sh2d@arcor.de}}
\title{\pkg\thanks{This document describes the \pkg\ packgae v0.1.}}
\maketitle


\begin{abstract}
  This package aids spell-checking of \TeX\ documents compiled with the
  Lua\TeX\ engine.  It can give visual feedback in \acr{pdf} output
  similar to \acr{wysiwyg} word processors.  The package relies on an
  external spell-checker application to check spelling of a text file
  and to output a list of bad spellings.  The package should work with
  most spell-checkers, even dumb, \TeX-unaware ones.

  \emph{Warning!  This package is in a very early state.  Everything may
    change!}
\end{abstract}

\begin{multicols}{2}
\small
% Set toc entries ragged right.  Trick taken from tocloft.pdf.
\makeatletter
\renewcommand{\@tocrmarg}{2.55em plus1fil}
\makeatother
\tableofcontents
\end{multicols}


\section{Introduction}
\label{sec:intro}

Ther are three main approaches to spell-checking \TeX\ documents:

\begin{enumerate}

\item checking spelling in the |.tex| source file,

\item converting a |.tex| file to another format, for which a proved
  spell-checking solution exists,

\item checking spelling after a |.tex| file has been processed by \TeX.

\end{enumerate}

All of these approaches have their strengths and weaknesses.  This
package follows the third approach, providing some unique features:

\begin{itemize}

\item When extracting text from typeset \acr{dvi}, \acr{ps} or \acr{pdf}
  files, hyphenation has to be switched off during the \TeX\ run to
  avoid lots of false positives being reported by the spell-checker.
  That is, one doesn't work on the original document.

  In contrast to that, the \pkg\ package works transparently on the
  original |.tex| source file.  Text is extracted \emph{during}
  typesetting, after Lua\TeX\ has applied its catcode and macro
  machinery, but before hyphenation takes place.

\item The \pkg\ package can highlight words with known incorrect
  spelling in \acr{pdf} output, giving visual feedback similar to
  \acr{wysiwyg} word processors.%
  \footnote{Currently, only colouring words is implemented.}

\end{itemize}


\section{Usage}
\label{sec:usage}

The \pkg\ package requires the Lua\TeX\ engine.  Currently, only the
\LaTeX\ format is supported.  \emph{The package consists of Lua modules
  that do the actual work.  The \LaTeX\ package is effectively a wrapper
  around the modules' Lua-API.  Implementing support for other formats
  shouldn't be too difficult.  Since the author is a \LaTeX-only user,
  support has to be contributed by, \lpeg, you.  By the way, the \LaTeX\
  package needs some polishing, too.  Contributions are welcome!}


\subsection{Work-flow}
\label{sec:work-flow}

The work-flow of the \pkg\ package is as follows:

\begin{enumerate}

\item After the package is loaded in the preamble of a |.tex| source
  file via °\usepackage{spelling}°, a list of bad spellings is read from
  a file named \descr{jobname}|.spb|, if that file exists.

\item During the Lua\TeX\ run, text is extracted from pages and all
  words are checked against the list of bad spellings.  Words with a
  known incorrect spelling are highlighted in \acr{pdf} output.

\item At the end of the Lua\TeX\ run, in addition to the \acr{pdf} file,
  a text file is written, named \descr{jobname}|.txt|, by default.  The
  text file should contain most of the text of the original document.

\item The text file is then checked by your favourite spell-checker
  application, \lpeg, Aspell or Hunspell.  The spell-checker should be
  able to write a list of bad spellings to a file.  Otherwise, visual
  feedback in \acr{pdf} output won't work.  The file should preferably
  be named \descr{jobname}|.spb|, but any other file name works just as
  well.

\item Now, there are two ways to proceed:

  \begin{enumerate}

  \item Visually minded people may just compile their document a second
    time.  This time, file \descr{jobname}|.spb| is read-in again and
    the words with incorrect spelling found by the spell-checker should
    now be highlighted in \acr{pdf} output.  Checking the \acr{pdf}
    file, the necessary corrections to the |.tex| source file can be
    applied.

  \item If you're not interested in visual feedback or if your
    spell-checker doesn't provide a non-interactive mode, you can as
    well apply the necessary corrections directly to the |.tex| source
    file(s), either interactively, during the spell-checker run, or by
    looking at the final list of bad spellings in an editor (whatever
    file it was saved to).  That way, the benefit of this package is,
    that spell-checker input has already been processed by Lua\TeX, but
    contains no hyphenated words.

  \end{enumerate}

\end{enumerate}


\subsection{Word lists}
\label{sec:wordlists}

As described above, if a file \descr{jobname}|.spb| exists, it is loaded
by the \pkg\ package.  The words found in the file are stored in an
internal list of bad spellings and are later used for highlighting
spelling mistakes in \acr{pdf} output.  Words from additional files can
be appended to the internal list of bad spellings with the
\macro{spellingreadbad} command.  Argument is a file name.  The format
of a word list file is one word per line.  The same word may occur
multiple times.  The file must be in the \acr{utf-8} encoding.

In addition to file \descr{jobname}|.spb|, a second file
\descr{jobname}|.spg| is read, if that file exists.  The words found in
that file are stored in an internal list of good spellings.  Words in
the Lua\TeX\ document are only considered spelling mistakes if they
occur in the list of bad spellings, but not in the list of good
spellings.  That is, words in the list of good spellings are never
highlighted in \acr{pdf} output.  The list of good spellings can be used
to deal with false positives (words incorrectly reported as bad
spellings by the spell-checker).  Words from additional files can be
appended to the internal list of good spellings with the
\macro{spellingreadgood} command.  Argument is a file name.  File format
is one word per line.  The same word may occur multiple times.  The file
must be in the \acr{utf-8} encoding.

Note, most spell-checkers provide means to deal with unknown words via
additional dictionaries.  It is recommended to configure your
spell-checker to report as few false positives as possible.


\subsection{Highlighting spellling mistakes}
\label{sec:highlight}

\paragraph{Enabling/disabling} Highlighting spelling mistakes (words
with known incorrect spelling) in \acr{pdf} output can be toggled on and
off with command \macro{spellinghighlight}.  If the argument is |on|,
highlighting is enabled.  For other arguments, highlighting is disabled.
Highlighting is enabled, by default.

\paragraph{Colour} The colour used for highlighting bad spellings can be
determined by command \cmd{spellinghighlightcolor}.  Argument is a
colour statement in the \acr{pdf} language.  As an example, the colour
red in the \acr{rgb} colour space is represented by the statement %
|1 0 0 rg|.  In the \acr{cmyk} colour space, a reddish colour is
represented by |0 1 1 0 k|.  Default colour used for highlighting is %
|1 0 0 rg|, \lpie, red in the \acr{rgb} colour space.  \emph{Warning:
  There's currently no error checking.  Make sure, you're applying a
  valid PDF colour statement!}


\end{document}



%%% Local Variables: 
%%% mode: latex
%%% TeX-PDF-mode: t
%%% TeX-master: t
%%% coding: utf-8
%%% End: 
